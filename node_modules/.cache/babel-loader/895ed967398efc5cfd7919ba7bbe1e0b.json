{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\yamat\\\\Workspace\\\\hark_bird_app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,createContext,useContext}from'react';import Konva from'konva';import useImage from'use-image';import{Stage,Layer,Star,Rect,Text,Image}from'react-konva';import request from\"superagent\";import{UserCount}from'../App';import Reset from'./Reset';var URLImage=function URLImage(props){var _useImage=useImage(props.url),_useImage2=_slicedToArray(_useImage,1),image=_useImage2[0];return/*#__PURE__*/React.createElement(Image,{image:image,x:props.x,y:props.y,scaleX:props.scaleX,scaleY:props.scaleY,draggable:props.draggable,dragBoundFunc:props.dragBoundFunc});};var Main=function Main(){var _useContext=useContext(UserCount),_useContext2=_slicedToArray(_useContext,2),count=_useContext2[0],setCount=_useContext2[1];var _useState=useState(null),_useState2=_slicedToArray(_useState,2),img_data=_useState2[0],setImgData=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),localized_data=_useState4[0],setLocalizedData=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),data_ia_loaded=_useState6[0],setDataIsLoaded=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),ldata_ia_loaded=_useState8[0],setLDataIsLoaded=_useState8[1];var _useState9=useState(-1),_useState10=_slicedToArray(_useState9,2),ldata_is_selected=_useState10[0],setLDataIsSelected=_useState10[1];var _useState11=useState(1.0),_useState12=_slicedToArray(_useState11,2),zoom_rate=_useState12[0],setZoomRate=_useState12[1];var _useState13=useState(10.0),_useState14=_slicedToArray(_useState13,2),img_pos_x=_useState14[0],setImgPosX=_useState14[1];var getSpectrumImg=function getSpectrumImg(){request.get(\"/api/getSpectrumImg\").end(function(err,data){if(err){console.error(err);return;}setImgData(data.body);setDataIsLoaded(true);return;});};var getLocalizedData=function getLocalizedData(){request.get(\"/api/getLocalizedData\").end(function(err,data){if(err){console.error(err);return;}setLocalizedData(data.body.localized_data);setLDataIsLoaded(true);return;});};var sendAnnotationData=function sendAnnotationData(){request.post(\"/api/sendAnnotationData\").send(localized_data).end(function(err,res){if(err){console.error(err);return;}console.log(res.body.res);return;});};var updateLocalizedPos=function updateLocalizedPos(e){var temp=localized_data.slice(0);var idx=ldata_is_selected+1;temp[idx][2]=String((e.target.x()-img_pos_x)*(img_data.music.t_max/992)/zoom_rate);temp[idx][4]=String(-((e.target.y()+10)/(740/2))*360+180);setLocalizedData(temp);};var zoomStage=function zoomStage(e){e.evt.preventDefault();setZoomRate(zoom_rate+e.evt.deltaY*-0.001);};var moveXImage=function moveXImage(pos){setImgPosX(pos.x);return{\"x\":pos.x,\"y\":0};};var playWav=function playWav(idx){// ローカルファイル再生不可能問題のため未実装\nconsole.log(\"play sep_\"+String(idx)+\".vaw.\");};var reset=function reset(){setDataIsLoaded(false);setLDataIsLoaded(false);setLDataIsSelected(-1);setZoomRate(1.0);setImgPosX(10.0);};var button_area=function button_area(){if(data_ia_loaded){return/*#__PURE__*/React.createElement(\"div\",{className:\"button_area\"},/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return getSpectrumImg();}},\"Load Spectrum\"),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return getLocalizedData();}},\"Load Localized Sata\"),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return sendAnnotationData();}},\"Save Annotation Sata\"),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return reset();}},\"Resrt\"));}else{return/*#__PURE__*/React.createElement(\"div\",{className:\"button_area\"},/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return getSpectrumImg();}},\"load Spectrum\"));}};var stage_area=function stage_area(){if(data_ia_loaded){return/*#__PURE__*/React.createElement(\"div\",{className:\"stage_area\"},/*#__PURE__*/React.createElement(\"div\",{className:\"Stage1\"},/*#__PURE__*/React.createElement(\"p\",null,\"Specgram\"),/*#__PURE__*/React.createElement(Stage,{width:window.innerWidth,height:window.innerHeight/4},/*#__PURE__*/React.createElement(Layer,{onWheel:function onWheel(e){return zoomStage(e);}},/*#__PURE__*/React.createElement(URLImage//url=\"https://raw.githubusercontent.com/yamatakeru/image_src/master/specgram.png\"\n,{url:img_data.specgram.img_path,x:img_pos_x,y:0.0,scaleX:zoom_rate,scaleY:0.5,draggable:true,dragBoundFunc:function dragBoundFunc(pos){return moveXImage(pos);}}),/*#__PURE__*/React.createElement(Text,{text:\"specgram\"})))),/*#__PURE__*/React.createElement(\"div\",{className:\"Stage2\"},/*#__PURE__*/React.createElement(\"p\",null,\"Music\"),/*#__PURE__*/React.createElement(Stage,{width:window.innerWidth,height:window.innerHeight/4},/*#__PURE__*/React.createElement(Layer,{onWheel:function onWheel(e){return zoomStage(e);}},/*#__PURE__*/React.createElement(URLImage//url=\"https://raw.githubusercontent.com/yamatakeru/image_src/master/music.png\"\n,{url:img_data.music.img_path,x:img_pos_x,y:0.0,scaleX:zoom_rate,scaleY:0.5,draggable:true,dragBoundFunc:function dragBoundFunc(pos){return moveXImage(pos);}}),/*#__PURE__*/React.createElement(Text,{text:\"music\"}),localized_data.slice(1).map(function(ld){return/*#__PURE__*/React.createElement(Rect,{x:parseFloat(ld[2])/img_data.music.t_max*992*zoom_rate+img_pos_x,y:(-parseFloat(ld[4])+180)/360*(740/2)-10,draggable:true,width:parseFloat(ld[3])/img_data.music.t_max*992*zoom_rate,height:20,fill:\"red\",stroke:\"black\",strokeWidth:2,onClick:function onClick(){return setLDataIsSelected(parseInt(ld[0]));},onDragStart:function onDragStart(){return setLDataIsSelected(parseInt(ld[0]));},onDragEnd:function onDragEnd(e){return updateLocalizedPos(e);},onDblClick:function onDblClick(){return playWav(parseInt(ld[0]));}});})))));}else{return/*#__PURE__*/React.createElement(\"p\",null,\"Please load spectrum data.\");}};var localized_data_area=function localized_data_area(){if(ldata_ia_loaded&&ldata_is_selected>=0){return/*#__PURE__*/React.createElement(\"dev\",{className:\"localized_info\"},/*#__PURE__*/React.createElement(\"p\",null,\"Localized Information\"),localized_data.slice(1)[ldata_is_selected].map(function(d){return/*#__PURE__*/React.createElement(\"ul\",null,d);}));}return;};return/*#__PURE__*/React.createElement(\"div\",{className:\"Main\"},button_area(),stage_area(),localized_data_area());};export default Main;","map":{"version":3,"sources":["C:/Users/yamat/Workspace/hark_bird_app/src/components/Main.js"],"names":["React","useState","useEffect","createContext","useContext","Konva","useImage","Stage","Layer","Star","Rect","Text","Image","request","UserCount","Reset","URLImage","props","url","image","x","y","scaleX","scaleY","draggable","dragBoundFunc","Main","count","setCount","img_data","setImgData","localized_data","setLocalizedData","data_ia_loaded","setDataIsLoaded","ldata_ia_loaded","setLDataIsLoaded","ldata_is_selected","setLDataIsSelected","zoom_rate","setZoomRate","img_pos_x","setImgPosX","getSpectrumImg","get","end","err","data","console","error","body","getLocalizedData","sendAnnotationData","post","send","res","log","updateLocalizedPos","e","temp","slice","idx","String","target","music","t_max","zoomStage","evt","preventDefault","deltaY","moveXImage","pos","playWav","reset","button_area","stage_area","window","innerWidth","innerHeight","specgram","img_path","map","ld","parseFloat","parseInt","localized_data_area","d"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, createContext, useContext } from 'react'\r\nimport Konva from 'konva';\r\nimport useImage from 'use-image';\r\nimport { Stage, Layer, Star, Rect, Text, Image } from 'react-konva';\r\nimport request from \"superagent\";\r\nimport { UserCount } from '../App';\r\nimport Reset from './Reset';\r\n\r\n\r\nconst URLImage = (props) => {\r\n  const [image] = useImage(props.url);\r\n  return <Image\r\n    image={image}\r\n    x={props.x}\r\n    y={props.y}\r\n    scaleX={props.scaleX}\r\n    scaleY={props.scaleY}\r\n    draggable={props.draggable}\r\n    dragBoundFunc={props.dragBoundFunc}\r\n  />;\r\n};\r\n\r\n\r\nconst Main = () => {\r\n  const [count, setCount] = useContext(UserCount);\r\n  const [img_data, setImgData] = useState(null);\r\n  const [localized_data, setLocalizedData] = useState([]);\r\n  const [data_ia_loaded, setDataIsLoaded] = useState(false);\r\n  const [ldata_ia_loaded, setLDataIsLoaded] = useState(false);\r\n  const [ldata_is_selected, setLDataIsSelected] = useState(-1);\r\n  const [zoom_rate, setZoomRate] = useState(1.0);\r\n  const [img_pos_x, setImgPosX] = useState(10.0)\r\n\r\n  const getSpectrumImg = () => {\r\n    request\r\n      .get(\"/api/getSpectrumImg\")\r\n      .end((err, data) => {\r\n        if (err) {\r\n          console.error(err);\r\n          return;\r\n        }\r\n          setImgData(data.body);\r\n          setDataIsLoaded(true);\r\n          return;\r\n      });\r\n  };\r\n\r\n  const getLocalizedData = () => {\r\n    request\r\n      .get(\"/api/getLocalizedData\")\r\n      .end((err, data) => {\r\n        if (err) {\r\n          console.error(err);\r\n          return;\r\n        }\r\n          setLocalizedData(data.body.localized_data);\r\n          setLDataIsLoaded(true);\r\n          return;\r\n      });\r\n  };\r\n\r\n  const sendAnnotationData = () => {\r\n    request\r\n    .post(\"/api/sendAnnotationData\")\r\n    .send(localized_data)\r\n    .end((err, res) => {\r\n      if (err) {\r\n        console.error(err);\r\n        return;\r\n      }\r\n        console.log(res.body.res);\r\n        return;\r\n    });\r\n  };\r\n\r\n  const updateLocalizedPos = (e) => {\r\n    const temp = localized_data.slice(0);\r\n    const idx = ldata_is_selected + 1;\r\n    \r\n    temp[idx][2] = String(((e.target.x() - img_pos_x) * (img_data.music.t_max / 992)) / zoom_rate);\r\n    temp[idx][4] = String((-((e.target.y() + 10) / (740 / 2))) * 360 + 180);\r\n    setLocalizedData(temp);\r\n  };\r\n\r\n  const zoomStage = (e) => {\r\n    e.evt.preventDefault();\r\n    setZoomRate(zoom_rate + e.evt.deltaY * -0.001);\r\n  };\r\n\r\n  const moveXImage = (pos) => {\r\n    setImgPosX(pos.x)\r\n    return {\"x\": pos.x, \"y\": 0}\r\n  };\r\n\r\n  const playWav = (idx) => {\r\n    // ローカルファイル再生不可能問題のため未実装\r\n    console.log(\"play sep_\"+String(idx)+\".vaw.\");\r\n  };\r\n\r\n  const reset = () => {\r\n    setDataIsLoaded(false);\r\n    setLDataIsLoaded(false);\r\n    setLDataIsSelected(-1); \r\n    setZoomRate(1.0);\r\n    setImgPosX(10.0);\r\n\r\n  };\r\n\r\n  const button_area = () => {\r\n    if (data_ia_loaded) {\r\n      return (\r\n        <div className=\"button_area\">\r\n          <button onClick={() => getSpectrumImg()}>\r\n            Load Spectrum\r\n          </button>\r\n          <button onClick={() => getLocalizedData()}>\r\n            Load Localized Sata\r\n          </button>\r\n          <button onClick={() => sendAnnotationData()}>\r\n            Save Annotation Sata\r\n          </button>\r\n          <button onClick={() => reset()}>\r\n            Resrt\r\n          </button>\r\n      </div>\r\n      );\r\n    } else {\r\n      return (\r\n        <div className=\"button_area\">\r\n          <button onClick={() => getSpectrumImg()}>\r\n            load Spectrum\r\n          </button>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  const stage_area = () => {\r\n    if (data_ia_loaded) {\r\n      return (\r\n        <div className=\"stage_area\">\r\n          <div className=\"Stage1\">\r\n            <p>Specgram</p>\r\n            <Stage width={window.innerWidth} height={window.innerHeight/4}>\r\n              <Layer\r\n                onWheel={e => zoomStage(e)}\r\n              >\r\n                <URLImage\r\n                  //url=\"https://raw.githubusercontent.com/yamatakeru/image_src/master/specgram.png\"\r\n                  url={img_data.specgram.img_path}\r\n                  x={img_pos_x}\r\n                  y={0.0}\r\n                  scaleX={zoom_rate}\r\n                  scaleY={0.5}\r\n                  draggable={true}\r\n                  dragBoundFunc={(pos) => moveXImage(pos)}\r\n                />\r\n                <Text text=\"specgram\" />\r\n              </Layer>\r\n            </Stage>\r\n          </div>\r\n          <div className=\"Stage2\">\r\n          <p>Music</p>\r\n          <Stage width={window.innerWidth} height={window.innerHeight/4}>\r\n            <Layer\r\n              onWheel={e => zoomStage(e)}\r\n            >\r\n              <URLImage\r\n                //url=\"https://raw.githubusercontent.com/yamatakeru/image_src/master/music.png\"\r\n                url={img_data.music.img_path}\r\n                x={img_pos_x}\r\n                y={0.0}\r\n                scaleX={zoom_rate}\r\n                scaleY={0.5}\r\n                draggable={true}\r\n                dragBoundFunc={(pos) => moveXImage(pos)}\r\n              />\r\n              <Text text=\"music\" />\r\n              {localized_data.slice(1).map(ld => {\r\n                return (\r\n                  <Rect\r\n                    x={(((parseFloat(ld[2]) / img_data.music.t_max) * 992) * zoom_rate) + img_pos_x}\r\n                    y={((-parseFloat(ld[4]) + 180) / 360) * (740 / 2) - 10}\r\n                    draggable={true}\r\n                    width={((parseFloat(ld[3]) / img_data.music.t_max) * 992) * zoom_rate}\r\n                    height={20}\r\n                    fill=\"red\"\r\n                    stroke='black'\r\n                    strokeWidth={2}\r\n                    onClick={() => setLDataIsSelected(parseInt(ld[0]))}\r\n                    onDragStart={() => setLDataIsSelected(parseInt(ld[0]))}\r\n                    onDragEnd={e =>updateLocalizedPos(e)}\r\n                    onDblClick={() => playWav(parseInt(ld[0]))}\r\n                  />\r\n                )})\r\n              }\r\n            </Layer>\r\n          </Stage>\r\n        </div>\r\n      </div>\r\n      );\r\n    } else {\r\n      return <p>Please load spectrum data.</p>;\r\n    }\r\n  };\r\n\r\n  const localized_data_area = () => {\r\n    if (ldata_ia_loaded && ldata_is_selected >= 0) {\r\n      return (\r\n        <dev className=\"localized_info\">\r\n          <p>Localized Information</p>\r\n          {localized_data.slice(1)[ldata_is_selected].map(d => {\r\n            return <ul>{d}</ul>\r\n            })\r\n          }\r\n        </dev>\r\n      );\r\n    }\r\n    return;\r\n  };\r\n\r\n  return (\r\n    <div className=\"Main\">\r\n      {button_area()}\r\n      {stage_area()}\r\n      {localized_data_area()}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Main;\r\n"]},"metadata":{},"sourceType":"module"}