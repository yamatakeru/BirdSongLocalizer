{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\yamat\\\\Workspace\\\\BirdSongLocalizer\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,createContext,useContext}from'react';import Konva from'konva';import useImage from'use-image';import{Stage,Layer,Star,Rect,Text,Image,Transformer}from'react-konva';import request from\"superagent\";import{UserCount}from'../App';import Reset from'./Reset';var URLImage=function URLImage(props){var _useImage=useImage(props.url),_useImage2=_slicedToArray(_useImage,1),image=_useImage2[0];return/*#__PURE__*/React.createElement(Image,{image:image,x:props.x,y:props.y,scaleX:props.scaleX,scaleY:props.scaleY,draggable:props.draggable,dragBoundFunc:props.dragBoundFunc});};var SoundSource=function SoundSource(props){//shapeProps, isSelected, onSelect, onChange\nvar shapeRef=React.useRef();var trRef=React.useRef();React.useEffect(function(){if(props.isSelected){// we need to attach transformer manually\ntrRef.current.nodes([shapeRef.current]);trRef.current.getLayer().batchDraw();}},[props.isSelected]);return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Rect,{x:props.x,y:props.y,width:props.width,height:props.height,fill:props.fill,stroke:props.stroke,strokeWidth:props.strokeWidth,opacity:props.opacity,onClick:props.onSelect,onTap:props.onSelect,ref:shapeRef,draggable:props.draggable,onDragEnd:function onDragEnd(e){props.onChange(e.target.x(),e.target.y(),e.target.width(),e.target.height());},onDblClick:props.onDblClick,onTransformEnd:function onTransformEnd(e){// transformer is changing scale of the node\n// and NOT its width or height\n// but in the store we have only width and height\n// to match the data better we will reset scale on transform end\nvar node=shapeRef.current;var scaleX=node.scaleX();var scaleY=node.scaleY();// we will reset it back\nnode.scaleX(1);node.scaleY(1);props.onChange(node.x(),node.y(),Math.max(5,node.width()*scaleX),node.height());}}),props.isSelected&&/*#__PURE__*/React.createElement(Transformer,{ref:trRef,boundBoxFunc:function boundBoxFunc(oldBox,newBox){// limit resize\nif(newBox.width<5||newBox.y!==oldBox.y||newBox.height!==oldBox.height){return oldBox;}return newBox;}}));};var Main=function Main(){var _useContext=useContext(UserCount),_useContext2=_slicedToArray(_useContext,2),count=_useContext2[0],setCount=_useContext2[1];var _useState=useState(null),_useState2=_slicedToArray(_useState,2),img_data=_useState2[0],setImgData=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),localized_data=_useState4[0],setLocalizedData=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),data_ia_loaded=_useState6[0],setDataIsLoaded=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),ldata_ia_loaded=_useState8[0],setLDataIsLoaded=_useState8[1];var _useState9=useState(-1),_useState10=_slicedToArray(_useState9,2),ldata_is_selected=_useState10[0],setLDataIsSelected=_useState10[1];var _useState11=useState(1.0),_useState12=_slicedToArray(_useState11,2),zoom_rate=_useState12[0],setZoomRate=_useState12[1];var _useState13=useState(10.0),_useState14=_slicedToArray(_useState13,2),img_pos_x=_useState14[0],setImgPosX=_useState14[1];var _useState15=useState(0),_useState16=_slicedToArray(_useState15,2),current_img_num=_useState16[0],setCurrentImgNum=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),relative=_useState18[0],setRelative=_useState18[1];var getSpectrumImg=function getSpectrumImg(){request.get(\"/api/getSpectrumImg\").end(function(err,data){if(err){console.error(err);return;}setImgData(data.body);setDataIsLoaded(true);console.log(data.body);return;});};var getLocalizedData=function getLocalizedData(){request.get(\"/api/getLocalizedData\").end(function(err,data){if(err){console.error(err);return;}setLocalizedData(data.body.localized_data);setLDataIsLoaded(true);return;});};var sendAnnotationData=function sendAnnotationData(){request.post(\"/api/sendAnnotationData\").send(localized_data).end(function(err,res){if(err){console.error(err);return;}console.log(res.body.res);return;});};var updateLocalizedPos=function updateLocalizedPos(x,y,width,height){var temp=localized_data.slice(0);var idx=ldata_is_selected+1;temp[idx][2]=String(relative?(x-img_pos_x)/zoom_rate*(img_data.music.t_max/992):((x-img_pos_x)/zoom_rate+current_img_num*img_data.music.dt_num)*(img_data.music.t_max/992));temp[idx][4]=String(-((y+10-20)/(740/2))*360+180);setLocalizedData(temp);};var zoomStage=function zoomStage(e){e.evt.preventDefault();var next_zoom_rate=zoom_rate+e.evt.deltaY*-0.001;if(next_zoom_rate<1.0){next_zoom_rate=1.0;}setZoomRate(next_zoom_rate);};var changeZoomRate=function changeZoomRate(zr){setImgPosX(img_pos_x-(zr-zoom_rate)*img_data.specgram.t_max/2);setZoomRate(zr);};var moveXImage=function moveXImage(pos,type){var next_pos_x=pos.x;// pos.x < 10.0 ? 10.0 : pos.x;\nvar next_pos_y=type===\"music\"?20.0:0.0;setImgPosX(relative?next_pos_x-current_img_num*img_data.music.dt_num*zoom_rate:next_pos_x);return{\"x\":next_pos_x,\"y\":next_pos_y};};var changeImageArea=function changeImageArea(next_img_num){setCurrentImgNum(next_img_num);};var playWav=function playWav(idx){var music=new Audio(img_data.sound_source_paths[idx]);music.play();};var reset=function reset(){setDataIsLoaded(false);setLDataIsLoaded(false);setLDataIsSelected(-1);setZoomRate(1.0);setImgPosX(10.0);setCurrentImgNum(0);setRelative(false);};var op_button_area=function op_button_area(){if(data_ia_loaded){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"op_button_area1\"},/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return getSpectrumImg();}},\"Load Spectrum\"),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return getLocalizedData();}},\"Load Localized Sata\"),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return sendAnnotationData();}},\"Save Annotation Sata\"),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return reset();}},\"Resrt\")),/*#__PURE__*/React.createElement(\"div\",{className:\"op_button_area2\"},/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return changeZoomRate(1.0);}},\"x1\"),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return changeZoomRate(2.0);}},\"x2\"),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return changeZoomRate(4.0);}},\"x4\"),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return changeZoomRate(8.0);}},\"x8\"),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return changeZoomRate(16.0);}},\"x16\"),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return changeImageArea(current_img_num-1>=0?current_img_num-1:0);}},\"--\"),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return changeImageArea(current_img_num+1<img_data.music.sp_num?current_img_num+1:img_data.music.sp_num);}},\"++\"),/*#__PURE__*/React.createElement(\"input\",{type:\"checkbox\",checked:relative,onChange:function onChange(){setRelative(!relative);}}),\"relative\"));}else{return/*#__PURE__*/React.createElement(\"div\",{className:\"button_area1\"},/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return getSpectrumImg();}},\"Load Spectrum\"));}};var stage_area=function stage_area(){if(data_ia_loaded){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"Stage1\"},/*#__PURE__*/React.createElement(\"p\",null,\"Specgram x\",zoom_rate,\", \",current_img_num),/*#__PURE__*/React.createElement(Stage,{width:window.innerWidth,height:740/2},/*#__PURE__*/React.createElement(Layer//onWheel={e => zoomStage(e)}\n,null,/*#__PURE__*/React.createElement(Rect,{x:0.0,y:0.0,width:window.innerWidth,height:740/2,fill:\"LightGray\"}),/*#__PURE__*/React.createElement(URLImage,{url:img_data.specgram.sp_img_paths[current_img_num],x:relative?img_pos_x+current_img_num*img_data.music.dt_num*zoom_rate:img_pos_x,y:0.0,scaleX:zoom_rate,scaleY:0.5,draggable:true,dragBoundFunc:function dragBoundFunc(pos){return moveXImage(pos,\"specgram\");}})))),/*#__PURE__*/React.createElement(\"div\",{className:\"Stage2\"},/*#__PURE__*/React.createElement(\"p\",null,\"Music\"),/*#__PURE__*/React.createElement(Stage,{width:window.innerWidth,height:740/2+40},/*#__PURE__*/React.createElement(Layer//onWheel={e => zoomStage(e)}\n,null,/*#__PURE__*/React.createElement(Rect,{x:0.0,y:0.0,width:window.innerWidth,height:740/2+40,fill:\"LightGray\"}),/*#__PURE__*/React.createElement(URLImage,{url:img_data.music.sp_img_paths[current_img_num],x:relative?img_pos_x+current_img_num*img_data.music.dt_num*zoom_rate:img_pos_x,y:20,scaleX:zoom_rate,scaleY:0.5,draggable:true,dragBoundFunc:function dragBoundFunc(pos){return moveXImage(pos,\"music\");}}),localized_data.slice(1).filter(function(ld){return parseFloat(ld[2])>=img_data.music.t_max/992*current_img_num*img_data.music.dt_num&&parseFloat(ld[2])<img_data.music.t_max/992*(current_img_num+2)*img_data.music.dt_num;}).map(function(ld){return/*#__PURE__*/React.createElement(SoundSource,{key:\"ss\"+ld[0],x:relative?parseFloat(ld[2])/img_data.music.t_max*992*zoom_rate+img_pos_x:(parseFloat(ld[2])/img_data.music.t_max*992-current_img_num*img_data.music.dt_num)*zoom_rate+img_pos_x,y:(-parseFloat(ld[4])+180)/360*(740/2)-10+20,draggable:true,width:parseFloat(ld[3])/img_data.music.t_max*992*zoom_rate,height:20,fill:\"red\",stroke:\"black\",strokeWidth:2,opacity:0.6,isSelected:parseInt(ld[0])===ldata_is_selected,onSelect:function onSelect(){return setLDataIsSelected(parseInt(ld[0]));},onChange:updateLocalizedPos,onDblClick:function onDblClick(){return playWav(parseInt(ld[0]));}});})))));}else{return/*#__PURE__*/React.createElement(\"p\",null,\"Please load spectrum data.\");}};var localized_data_area=function localized_data_area(){if(ldata_ia_loaded&&ldata_is_selected>=0){return/*#__PURE__*/React.createElement(\"dev\",{className:\"localized_info\"},/*#__PURE__*/React.createElement(\"p\",null,\"Localized Information\"),localized_data.slice(1)[ldata_is_selected].map(function(d){return/*#__PURE__*/React.createElement(\"ul\",null,d);}));}return;};return/*#__PURE__*/React.createElement(\"div\",{className:\"Main\"},op_button_area(),stage_area(),localized_data_area());};export default Main;","map":{"version":3,"sources":["C:/Users/yamat/Workspace/BirdSongLocalizer/src/components/Main.js"],"names":["React","useState","useEffect","createContext","useContext","Konva","useImage","Stage","Layer","Star","Rect","Text","Image","Transformer","request","UserCount","Reset","URLImage","props","url","image","x","y","scaleX","scaleY","draggable","dragBoundFunc","SoundSource","shapeRef","useRef","trRef","isSelected","current","nodes","getLayer","batchDraw","width","height","fill","stroke","strokeWidth","opacity","onSelect","e","onChange","target","onDblClick","node","Math","max","oldBox","newBox","Main","count","setCount","img_data","setImgData","localized_data","setLocalizedData","data_ia_loaded","setDataIsLoaded","ldata_ia_loaded","setLDataIsLoaded","ldata_is_selected","setLDataIsSelected","zoom_rate","setZoomRate","img_pos_x","setImgPosX","current_img_num","setCurrentImgNum","relative","setRelative","getSpectrumImg","get","end","err","data","console","error","body","log","getLocalizedData","sendAnnotationData","post","send","res","updateLocalizedPos","temp","slice","idx","String","music","t_max","dt_num","zoomStage","evt","preventDefault","next_zoom_rate","deltaY","changeZoomRate","zr","specgram","moveXImage","pos","type","next_pos_x","next_pos_y","changeImageArea","next_img_num","playWav","Audio","sound_source_paths","play","reset","op_button_area","sp_num","stage_area","window","innerWidth","sp_img_paths","filter","ld","parseFloat","map","parseInt","localized_data_area","d"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, createContext, useContext } from 'react'\r\nimport Konva from 'konva';\r\nimport useImage from 'use-image';\r\nimport { Stage, Layer, Star, Rect, Text, Image, Transformer } from 'react-konva';\r\nimport request from \"superagent\";\r\nimport { UserCount } from '../App';\r\nimport Reset from './Reset';\r\n\r\n\r\nconst URLImage = (props) => {\r\n  const [image] = useImage(props.url);\r\n  return <Image\r\n    image={image}\r\n    x={props.x}\r\n    y={props.y}\r\n    scaleX={props.scaleX}\r\n    scaleY={props.scaleY}\r\n    draggable={props.draggable}\r\n    dragBoundFunc={props.dragBoundFunc}\r\n  />;\r\n};\r\n\r\n\r\nconst SoundSource = (props) => { //shapeProps, isSelected, onSelect, onChange\r\n  const shapeRef = React.useRef();\r\n  const trRef = React.useRef();\r\n\r\n  React.useEffect(() => {\r\n    if (props.isSelected) {\r\n      // we need to attach transformer manually\r\n      trRef.current.nodes([shapeRef.current]);\r\n      trRef.current.getLayer().batchDraw();\r\n    }\r\n  }, [props.isSelected]);\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Rect\r\n        x={props.x}\r\n        y={props.y}\r\n        width={props.width}\r\n        height={props.height}\r\n        fill={props.fill}\r\n        stroke={props.stroke}\r\n        strokeWidth={props.strokeWidth}\r\n        opacity={props.opacity}\r\n        onClick={props.onSelect}\r\n        onTap={props.onSelect}\r\n        ref={shapeRef}\r\n        draggable={props.draggable}\r\n        onDragEnd={(e) => {props.onChange(e.target.x(), e.target.y(), e.target.width(), e.target.height())}}\r\n        onDblClick={props.onDblClick}\r\n        onTransformEnd={(e) => {\r\n          // transformer is changing scale of the node\r\n          // and NOT its width or height\r\n          // but in the store we have only width and height\r\n          // to match the data better we will reset scale on transform end\r\n          const node = shapeRef.current;\r\n          const scaleX = node.scaleX();\r\n          const scaleY = node.scaleY();\r\n\r\n          // we will reset it back\r\n          node.scaleX(1);\r\n          node.scaleY(1);\r\n          props.onChange(node.x(), node.y(), Math.max(5, node.width() * scaleX), node.height());\r\n        }}\r\n      />\r\n      {props.isSelected && (\r\n        <Transformer\r\n          ref={trRef}\r\n          boundBoxFunc={(oldBox, newBox) => {\r\n            // limit resize\r\n            if (newBox.width < 5 || newBox.y !== oldBox.y || newBox.height !== oldBox.height) {\r\n              return oldBox;\r\n            }\r\n            return newBox;\r\n          }}\r\n        />\r\n      )}\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\n\r\nconst Main = () => {\r\n  const [count, setCount] = useContext(UserCount);\r\n  const [img_data, setImgData] = useState(null);\r\n  const [localized_data, setLocalizedData] = useState([]);\r\n  const [data_ia_loaded, setDataIsLoaded] = useState(false);\r\n  const [ldata_ia_loaded, setLDataIsLoaded] = useState(false);\r\n  const [ldata_is_selected, setLDataIsSelected] = useState(-1);\r\n  const [zoom_rate, setZoomRate] = useState(1.0);\r\n  const [img_pos_x, setImgPosX] = useState(10.0)\r\n  const [current_img_num, setCurrentImgNum] = useState(0);\r\n  const [relative, setRelative] = useState(false);\r\n\r\n  const getSpectrumImg = () => {\r\n    request\r\n      .get(\"/api/getSpectrumImg\")\r\n      .end((err, data) => {\r\n        if (err) {\r\n          console.error(err);\r\n          return;\r\n        }\r\n          setImgData(data.body);\r\n          setDataIsLoaded(true);\r\n          console.log(data.body);\r\n          return;\r\n      });\r\n  };\r\n\r\n  const getLocalizedData = () => {\r\n    request\r\n      .get(\"/api/getLocalizedData\")\r\n      .end((err, data) => {\r\n        if (err) {\r\n          console.error(err);\r\n          return;\r\n        }\r\n          setLocalizedData(data.body.localized_data);\r\n          setLDataIsLoaded(true);\r\n          return;\r\n      });\r\n  };\r\n\r\n  const sendAnnotationData = () => {\r\n    request\r\n    .post(\"/api/sendAnnotationData\")\r\n    .send(localized_data)\r\n    .end((err, res) => {\r\n      if (err) {\r\n        console.error(err);\r\n        return;\r\n      }\r\n        console.log(res.body.res);\r\n        return;\r\n    });\r\n  };\r\n\r\n  const updateLocalizedPos = (x, y, width, height) => {\r\n    const temp = localized_data.slice(0);\r\n    const idx = ldata_is_selected + 1;\r\n    \r\n    temp[idx][2] = String(relative ?\r\n                            ((((x - img_pos_x) / zoom_rate)) * (img_data.music.t_max / 992)):\r\n                            ((((x - img_pos_x) / zoom_rate) + current_img_num * img_data.music.dt_num) * (img_data.music.t_max / 992)));\r\n    temp[idx][4] = String((-((y + 10-20) / (740 / 2))) * 360 + 180);\r\n    setLocalizedData(temp);\r\n  };\r\n\r\n  const zoomStage = (e) => {\r\n    e.evt.preventDefault();\r\n    var next_zoom_rate = zoom_rate + e.evt.deltaY * -0.001;\r\n    if (next_zoom_rate < 1.0) {\r\n      next_zoom_rate = 1.0;\r\n    }\r\n    setZoomRate(next_zoom_rate);\r\n  };\r\n\r\n  const changeZoomRate = (zr) => {\r\n    \r\n    setImgPosX(img_pos_x -  (((zr - zoom_rate) * img_data.specgram.t_max) / 2));\r\n    setZoomRate(zr);\r\n  };\r\n\r\n  const moveXImage = (pos, type) => {\r\n    const next_pos_x = pos.x; // pos.x < 10.0 ? 10.0 : pos.x;\r\n    const next_pos_y = type === \"music\" ? 20.0: 0.0;\r\n\r\n    setImgPosX(relative? next_pos_x - (current_img_num * img_data.music.dt_num) * zoom_rate: next_pos_x);\r\n    return {\"x\": next_pos_x, \"y\": next_pos_y};\r\n  };\r\n\r\n  const changeImageArea = (next_img_num) => {\r\n    setCurrentImgNum(next_img_num);\r\n  };\r\n\r\n  const playWav = (idx) => {\r\n    const music = new Audio(img_data.sound_source_paths[idx]);\r\n    music.play();\r\n  };\r\n\r\n  const reset = () => {\r\n    setDataIsLoaded(false);\r\n    setLDataIsLoaded(false);\r\n    setLDataIsSelected(-1); \r\n    setZoomRate(1.0);\r\n    setImgPosX(10.0);\r\n    setCurrentImgNum(0);\r\n    setRelative(false);\r\n  };\r\n\r\n  const op_button_area = () => {\r\n    if (data_ia_loaded) {\r\n      return (\r\n        <React.Fragment>\r\n          <div className=\"op_button_area1\">\r\n            <button onClick={() => getSpectrumImg()}>\r\n              Load Spectrum\r\n            </button>\r\n            <button onClick={() => getLocalizedData()}>\r\n              Load Localized Sata\r\n            </button>\r\n            <button onClick={() => sendAnnotationData()}>\r\n              Save Annotation Sata\r\n            </button>\r\n            <button onClick={() => reset()}>\r\n              Resrt\r\n            </button>\r\n        </div>\r\n        <div className=\"op_button_area2\">\r\n          <button onClick={() => changeZoomRate(1.0)}>\r\n              x1\r\n          </button>\r\n          <button onClick={() => changeZoomRate(2.0)}>\r\n              x2\r\n          </button>\r\n          <button onClick={() => changeZoomRate(4.0)}>\r\n              x4\r\n          </button>\r\n          <button onClick={() => changeZoomRate(8.0)}>\r\n              x8\r\n          </button>\r\n          <button onClick={() => changeZoomRate(16.0)}>\r\n              x16\r\n          </button>\r\n          <button onClick={() => changeImageArea(current_img_num - 1 >= 0 ? current_img_num - 1: 0)}>\r\n              --\r\n          </button>\r\n          <button onClick={() => changeImageArea(current_img_num + 1 < img_data.music.sp_num ? current_img_num + 1: img_data.music.sp_num)}>\r\n              ++\r\n          </button>\r\n          <input type=\"checkbox\" checked={relative} onChange={() => {setRelative(!relative)}}/>\r\n            relative\r\n        </div>\r\n      </React.Fragment>\r\n      );\r\n    } else {\r\n      return (\r\n        <div className=\"button_area1\">\r\n          <button onClick={() => getSpectrumImg()}>\r\n            Load Spectrum\r\n          </button>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  const stage_area = () => {\r\n    if (data_ia_loaded) {\r\n      return (\r\n        <React.Fragment>\r\n          <div className=\"Stage1\">\r\n            <p>Specgram x{zoom_rate}, {current_img_num}</p>\r\n            <Stage width={window.innerWidth} height={740/2}>\r\n              <Layer\r\n                //onWheel={e => zoomStage(e)}\r\n              >\r\n                <Rect\r\n                  x={0.0}\r\n                  y={0.0}\r\n                  width={window.innerWidth}\r\n                  height={740/2}\r\n                  fill=\"LightGray\"\r\n                />\r\n                <URLImage\r\n                  url={img_data.specgram.sp_img_paths[current_img_num]}\r\n                  x={relative ? img_pos_x + (current_img_num * img_data.music.dt_num) * zoom_rate: img_pos_x}\r\n                  y={0.0}\r\n                  scaleX={zoom_rate}\r\n                  scaleY={0.5}\r\n                  draggable={true}\r\n                  dragBoundFunc={(pos) => moveXImage(pos, \"specgram\")}\r\n                />\r\n              </Layer>\r\n            </Stage>\r\n          </div>\r\n          <div className=\"Stage2\">\r\n          <p>Music</p>\r\n          <Stage width={window.innerWidth} height={(740/2) + 40}>\r\n            <Layer\r\n              //onWheel={e => zoomStage(e)}\r\n            >\r\n              <Rect\r\n                  x={0.0}\r\n                  y={0.0}\r\n                  width={window.innerWidth}\r\n                  height={(740/2) + 40}\r\n                  fill=\"LightGray\"\r\n              />\r\n              <URLImage\r\n                url={img_data.music.sp_img_paths[current_img_num]}\r\n                x={relative ? img_pos_x + (current_img_num * img_data.music.dt_num) * zoom_rate: img_pos_x}\r\n                y={20}\r\n                scaleX={zoom_rate}\r\n                scaleY={0.5}\r\n                draggable={true}\r\n                dragBoundFunc={(pos) => moveXImage(pos, \"music\")}\r\n              />\r\n              {localized_data.slice(1).filter(ld => (parseFloat(ld[2]) >= (img_data.music.t_max / 992) * current_img_num * img_data.music.dt_num\r\n                                                      && parseFloat(ld[2]) < (img_data.music.t_max / 992) * (current_img_num + 2) * img_data.music.dt_num)).map(ld => {\r\n                return (\r\n\r\n                  <SoundSource\r\n                    key={\"ss\" + ld[0]}\r\n                    x={relative ?\r\n                        (((parseFloat(ld[2]) / img_data.music.t_max) * 992) * zoom_rate) + img_pos_x:\r\n                        (((parseFloat(ld[2]) / img_data.music.t_max) * 992 - current_img_num * img_data.music.dt_num) * zoom_rate) + img_pos_x}\r\n                    y={((-parseFloat(ld[4]) + 180) / 360) * (740 / 2) - 10 + 20}\r\n                    draggable={true}\r\n                    width={((parseFloat(ld[3]) / img_data.music.t_max) * 992) * zoom_rate}\r\n                    height={20}\r\n                    fill=\"red\"\r\n                    stroke='black'\r\n                    strokeWidth={2}\r\n                    opacity={0.6}\r\n                    isSelected={parseInt(ld[0]) === ldata_is_selected}\r\n                    onSelect={() => setLDataIsSelected(parseInt(ld[0]))}\r\n                    onChange={updateLocalizedPos}\r\n                    onDblClick={() => playWav(parseInt(ld[0]))}\r\n\r\n                  />\r\n                )})\r\n              }\r\n            </Layer>\r\n          </Stage>\r\n        </div>\r\n      </React.Fragment>\r\n      );\r\n    } else {\r\n      return <p>Please load spectrum data.</p>;\r\n    }\r\n  };\r\n\r\n  const localized_data_area = () => {\r\n    if (ldata_ia_loaded && ldata_is_selected >= 0) {\r\n      return (\r\n        <dev className=\"localized_info\">\r\n          <p>Localized Information</p>\r\n          {localized_data.slice(1)[ldata_is_selected].map(d => {\r\n            return <ul>{d}</ul>\r\n            })\r\n          }\r\n        </dev>\r\n      );\r\n    }\r\n    return;\r\n  };\r\n\r\n  return (\r\n    <div className=\"Main\">\r\n      {op_button_area()}\r\n      {stage_area()}\r\n      {localized_data_area()}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Main;\r\n"]},"metadata":{},"sourceType":"module"}